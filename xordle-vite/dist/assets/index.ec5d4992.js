var U=Object.defineProperty,j=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var _=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var K=(n,s,e)=>s in n?U(n,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[s]=e,N=(n,s)=>{for(var e in s||(s={}))W.call(s,e)&&K(n,e,s[e]);if(_)for(var e of _(s))Y.call(s,e)&&K(n,e,s[e]);return n},x=(n,s)=>j(n,J(s));import{j as P,r as p,R as M,a as B}from"./vendor.8cd058a3.js";const F=function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))c(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&c(i)}).observe(document,{childList:!0,subtree:!0});function e(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerpolicy&&(r.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?r.credentials="include":t.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function c(t){if(t.ep)return;t.ep=!0;const r=e(t);fetch(t.href,r)}};F();const o=P.exports.jsx,m=P.exports.jsxs,L=P.exports.Fragment,S={MENU:"menu",CREATE:"create",JOIN:"join",EXIT:"exit",PLAY:"play"},V={MENU_OPTIONS:[{id:S.CREATE,text:"CREATE"},{id:S.JOIN,text:"JOIN"}],KEYS:{ROW_0:"qwertyuiop".toUpperCase().split(""),ROW_1:"asdfghjkl".toUpperCase().split(""),ROW_2:"zxcvbnm".toUpperCase().split("")},TRIANGLE_RIGHT:"/TriangleRight.png",PING_DELAY:25e3,BLANK:o(L,{children:"\xA0"})},E=N(N({},S),V),H="localhost:3300",z="ws://"+H;let u=null,k=null;const A={},O=(n,s)=>n.split(" ").forEach(e=>A[e]=s),G=()=>{u&&(console.warn("Client already iniitialized. Removing existing client..."),u.close(),clearInterval(k),k=null);const n=()=>{u.emit("PING")};return O("PING",()=>{console.log("Received server ping")}),O("SET_ID",s=>{u&&(u.id=s),console.log("Socket initialized")}),u=new WebSocket(z),u.emit=(s,e)=>{u?u.send(JSON.stringify({action:s,payload:e})):console.warn("No client found")},u.addEventListener("message",s=>{const{data:e}=s,{action:c,payload:t}=JSON.parse(e);A[c]&&A[c](t)}),u.addEventListener("close",s=>{console.warn("Client closed. Reconnecting..."),G()}),k=setInterval(n,E.PING_DELAY),u},C={init:G,listen:O},$=n=>{const{children:s,onReconnect:e}=n;return p.exports.useEffect(()=>{C.init(e)},[]),o(L,{children:s})},X=n=>{const{options:s,onClick:e,className:c}=n,t=()=>c?" "+c:"",r=i=>{const{id:f}=i.target;e&&f&&e(f)};return o("div",{className:"menu flex-col"+t(),onClick:r,children:s.map(({id:i,text:f})=>m("button",{id:i,children:[" ",f," "]},i))})};const w=n=>{switch(parseInt(n)){case 1:return"bg-green";case 2:return"bg-yellow";case 3:return"bg-neutral";case 4:return"bg-placeholder active";case 5:return"bg-placeholder";default:return"bg-gray"}},q=n=>n<33?"bg-red":n<66?"bg-yellow":"bg-green",Z=n=>/^[a-zA-Z]$/.test(n);const Q=n=>{const{keys:s,onClick:e,disabled:c}=n,t=i=>{var f;c||(i.preventDefault(),i.target.id?e&&e({key:i.target.id}):(f=i.touches)==null||f.forEach(a=>{e&&e({key:a.id})}))},r=(i,f,a)=>{const y=E.KEYS["ROW_"+i];return m("div",{className:"flex keyboard-row",children:[f,y.map(l=>o(T,{letter:l,status:(s==null?void 0:s[l])>=0?s[l]:3,id:l},l)),a]})};return m("div",{className:"keyboard flex-col "+(c?"disabled":""),onTouchEnd:t,onClick:t,children:[r(0),r(1),r(2,o(T,{letter:"ENTER",status:3,id:"enter"}),o(T,{letter:o(L,{children:"\xAB"}),status:3,id:"backspace"}))]})},T=({letter:n,status:s,className:e,id:c})=>{let t=["flex keyboard-key",w(s),e||""].join(" ");return m("button",{className:t,id:c,children:[" ",n," "]})},D=n=>{const{keys:s,history:e,inProgress:c,timeRemaining:t,keyboardDisabled:r,onKeyPress:i,current:f}=n,a=p.exports.useRef(null),y=p.exports.useRef(null);p.exports.useEffect(()=>{var d;(d=a==null?void 0:a.current)==null||d.focus()},[a]),p.exports.useEffect(()=>{y.current.scrollIntoView()},[f]);const l=d=>{if(!r)switch(d.key.toUpperCase()){case"ENTER":i&&i("ENTER");break;case"BACKSPACE":i&&i(null);break;default:Z(d.key)&&i&&i(d.key.toUpperCase());break}},g=()=>e==null?void 0:e.map((d,h)=>e.length-1===h?o("div",{className:"flex game-board-last",children:d==null?void 0:d.map((R,v)=>p.exports.createElement(I,x(N({},R),{key:R+v,delay:v*60})))},d+h):o("div",{className:"flex",children:d==null?void 0:d.map((R,v)=>p.exports.createElement(I,x(N({},R),{key:R+v})))},d+h)),b=()=>{const d=[];for(let h=0;h<5;h++)d.push(o(I,{letter:f[h],status:f[h]?4:5},(f[h]||"")+h));return d};return m("div",{className:"game-board flex-col flex-fill ",onKeyDown:l,tabIndex:"0",ref:a,children:[m("div",{className:"flex-col flex-fill overflow game-board-list",children:[g(),o("div",{className:"flex game-board-current",ref:y,children:c&&b()},e==null?void 0:e.length)]}),o(ee,{className:"game-board-progress",progress:t}),o(Q,{keys:s,disabled:r,onClick:l})]})},ee=({className:n,progress:s})=>{const e=s*100,c=[n||"","flex progress"].join(" "),t=["flex progress-bar",q(e)].join(" "),r={width:e+"%"};return o("div",{className:c,children:o("div",{className:t,style:r})})},I=({letter:n,status:s,delay:e})=>{const[c,t]=p.exports.useState("bg-placeholder");p.exports.useEffect(()=>{e&&setTimeout(()=>{t(w(s))},e)},[s,e]);const r=["flex game-board-letter",e?c:w(s)].join(" ");return o("div",{className:"game-board-letter-wrapper",children:m("span",{className:r,children:[" ",n||E.BLANK," "]})})},se=n=>{const{room:s}=n,[e,c]=p.exports.useState(null),[t,r]=p.exports.useState([]),i=()=>(e==null?void 0:e.host)===u.id;p.exports.useEffect(()=>{u.room=s,u.emit("JOIN",{room:s}),C.listen("JOIN",c),C.listen("UPDATE",l=>{c(g=>(console.log(l==null?void 0:l.status),(l==null?void 0:l.status)===1?r([]):(l==null?void 0:l.status)===0&&(l==null?void 0:l.turn)!==u.id&&r(l==null?void 0:l.current),l))})},[]);const f=()=>{i()&&u.emit("START")},a=()=>{i()&&u.emit("END")},y=l=>{l==="ENTER"?t.length===5?u.emit("ENTER_WORD"):r([]):r(l?g=>{const b=g.length<5?[...g,l]:g;return u.emit("SET_CURRENT",{current:b}),b}:g=>{if(g.length===0)return[];const b=[...g];return b.pop(),u.emit("SET_CURRENT",{current:b}),b})};return m("div",{className:"flex-col flex-fill game",children:[(e==null?void 0:e.inProgress)&&!(e!=null&&e.turn)&&m("div",{className:"flex-col flex-fill game-end",children:[o("label",{className:"game-end-label",children:" Word: "}),m("label",{className:"game-end-word",children:[" ",e==null?void 0:e.word," "]}),o("button",{className:i()?"":"hidden",onClick:a,children:" RESTART "})]}),(e==null?void 0:e.inProgress)&&o(D,{keys:e==null?void 0:e.keys,history:e==null?void 0:e.history,current:t,onKeyPress:y,inProgress:e==null?void 0:e.turn,timeRemaining:e==null?void 0:e.timeRemaining,keyboardDisabled:(e==null?void 0:e.turn)!==(u==null?void 0:u.id)}),!(e!=null&&e.inProgress)&&m("div",{className:"flex-col flex-fill game-lobby",children:[m("label",{className:"flex room-code",children:[" ",e==null?void 0:e.id," "]}),m("p",{className:"flex-col flex-fill",children:[" ",e==null?void 0:e.playerCount," PLAYER",(e==null?void 0:e.playerCount)>1?"S":""," "]}),o("button",{className:"start-btn",onClick:f,children:i()?"START":"WAITING FOR HOST"})]})]})},ne=()=>{const[n,s]=p.exports.useReducer(te,re),e=p.exports.useRef(!1);p.exports.useEffect(()=>{C.listen("CREATE",a=>{s({type:"viewJoin",payload:{room:a}}),e.current=!1}),C.listen("VERIFY",a=>{e.current=!1,a&&s({type:"viewJoin",payload:{room:a}})})},[]);const c=a=>{if(!e.current)switch(a){case E.CREATE:e.current=!0,u.emit("CREATE");break;case E.JOIN:s({type:"viewCodeInput"});break;case E.PLAY:e.current=!0,u.emit("VERIFY",{room:n.room});break;default:console.log(a);return}},t=a=>{s({type:"setCodeInput",payload:a.target.value.replace(/[^a-z]/gi,"").substring(0,5).toUpperCase()})},r=()=>{var a;return m("div",{className:"flex-col",children:[o("input",{className:"input",type:"text",placeholder:"ROOM CODE",value:n.room||"",onChange:t,spellCheck:"false",autoComplete:"false",autoFocus:!0}),o("button",{className:"flex play-btn "+(((a=n.room)==null?void 0:a.length)===5?"":"hidden"),onClick:()=>c(E.PLAY),children:o("img",{src:E.TRIANGLE_RIGHT})})]})};return o("div",{className:"app",children:o($,{onReconnect:()=>{u.emit("VERIFY",{room:n.room})},children:(()=>{switch(n.view){case"game":return o(se,{room:n.room});default:return m("div",{className:"main-screen flex-col flex-fill",children:[o("label",{className:"flex title-label",children:" XORDLE "}),n.view!=="codeInput"?o(X,{options:E.MENU_OPTIONS,onClick:c}):r()]})}})()})})},te=(n,s)=>{const{type:e,payload:c}=s;switch(e){case"viewMain":return x(N({},n),{view:null});case"viewJoin":return x(N({},n),{view:"game",room:c.room});case"viewCodeInput":return x(N({},n),{view:"codeInput"});case"setCodeInput":return x(N({},n),{room:c});default:return N({},n)}},re={view:E.VIEW,room:null};M.render(o(B.StrictMode,{children:o(ne,{})}),document.getElementById("root"));
